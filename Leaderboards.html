<!DOCTYPE html>
<html lang="en">
    <style>
        /* Add/override styles for leaderboard table */
        .main-content {
            margin-left: 260px;
            padding: 40px 20px 20px 20px;
            min-height: 100vh;
        }
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0,0,0,0.07);
        }
        .leaderboard-table th, .leaderboard-table td {
            padding: 16px 12px;
            text-align: center;
        }
        .leaderboard-table th {
            background: #e0f7fa;
            color: #006064;
            font-weight: 600;
        }
        .leaderboard-table tr:nth-child(even) {
            background: #f1f8fa;
        }
        .leaderboard-table tr:nth-child(odd) {
            background: #fff;
        }
        .leaderboards-title {
            font-size: 2rem;
        }
    </style>
    <!-- ...existing code... -->
</head>
<body>
    <div class="main-content">
        <h1 class="leaderboards-title">Leaderboards</h1>
        <table class="leaderboard-table" id="leaderboardTable">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Total Fish</th>
                    <th>Common</th>
                    <th>Rare</th>
                    <th>Epic</th>
                    <th>Legendary</th>
                </tr>
            </thead>
            <tbody id="leaderboardBody">
                <tr><td colspan="7">Loading...</td></tr>
            </tbody>
        </table>
    </div>
    <footer class="footer">
        <p style="text-align: center; color: rgb(15, 15, 15);">PERLAS 2024</p>
    </footer>
    <!-- Firebase leaderboard script -->
    <script defer src="Page/JS/firebase-init.js"></script>
    <script>
    // Assumes firebase-init.js loads and initializes firebase
    document.addEventListener('DOMContentLoaded', function() {
        // Wait for firebase to be loaded
        function waitForFirebase(cb) {
            if (window.firebase && firebase.database) cb();
            else setTimeout(() => waitForFirebase(cb), 100);
        }
        waitForFirebase(async function() {
            const leaderboardBody = document.getElementById('leaderboardBody');
            leaderboardBody.innerHTML = '<tr><td colspan="7">Loading...</td></tr>';
            try {
                // Fetch all users
                const usersSnap = await firebase.database().ref('users').once('value');
                const users = usersSnap.val() || {};
                const leaderboard = [];
                // For each user, fetch their caught fish info
                const userEntries = Object.entries(users);
                for (const [uid, user] of userEntries) {
                    // Assume caught fish are under users/{uid}/caughtFish or similar
                    let fishSnap = null;
                    try {
                        fishSnap = await firebase.database().ref('users/' + uid + '/caughtFish').once('value');
                    } catch (e) {}
                    const caughtFish = fishSnap && fishSnap.val() ? Object.values(fishSnap.val()) : [];
                    // Count by rarity
                    let total = 0, common = 0, rare = 0, epic = 0, legendary = 0;
                    for (const fish of caughtFish) {
                        total++;
                        const rarity = (fish.rarity || '').toLowerCase();
                        if (rarity === 'common') common++;
                        else if (rarity === 'rare') rare++;
                        else if (rarity === 'epic') epic++;
                        else if (rarity === 'legendary') legendary++;
                    }
                    leaderboard.push({
                        email: user.email || uid,
                        total,
                        common,
                        rare,
                        epic,
                        legendary
                    });
                }
                // Sort by total fish caught descending
                leaderboard.sort((a, b) => b.total - a.total);
                // Render table
                leaderboardBody.innerHTML = '';
                leaderboard.forEach((row, i) => {
                    leaderboardBody.innerHTML += `<tr>
                        <td>${i+1}</td>
                        <td>${row.email}</td>
                        <td>${row.total}</td>
                        <td>${row.common}</td>
                        <td>${row.rare}</td>
                        <td>${row.epic}</td>
                        <td>${row.legendary}</td>
                    </tr>`;
                });
                if (leaderboard.length === 0) leaderboardBody.innerHTML = '<tr><td colspan="7">No data found.</td></tr>';
            } catch (err) {
                leaderboardBody.innerHTML = '<tr><td colspan="7">Failed to load leaderboard.</td></tr>';
            }
        });
    });
    </script>
                    <td>30</td>
                    <td>10</td>
                </tr>
            </tbody>
        </table>
    </div>
    <footer class="footer">
        <p style="text-align: center; color: rgb(15, 15, 15);">PERLAS 2024</p>
    </footer>
</body>
</html>