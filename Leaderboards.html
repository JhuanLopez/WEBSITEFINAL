<!DOCTYPE html>
<html lang="en">
    <style>
        /* Add/override styles for leaderboard table */
        body {
            background: url('Page/CSS/templates/Water.png') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1;
        }
        .main-content {
            margin-left: 260px;
            padding: 40px 20px 20px 20px;
            min-height: 100vh;
        }
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0,0,0,0.07);
        }
        .leaderboard-table th, .leaderboard-table td {
            padding: 16px 12px;
            text-align: center;
        }
        .leaderboard-table th {
            background: #e0f7fa;
            color: #006064;
            font-weight: 600;
        }
        .leaderboard-table tr:nth-child(even) {
            background: #f1f8fa;
        }
        .leaderboard-table tr:nth-child(odd) {
            background: #fff;
        }
        .leaderboards-title {
            font-size: 2rem;
        }
        .table-responsive {
            width: 100%;
            overflow-x: auto;
        }
        .leaderboard-table {
            font-size: 1rem;
        }
        .leaderboard-table th, .leaderboard-table td {
            min-width: 90px;
        }
        .leaderboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            flex-wrap: wrap;
        }
        .leaderboard-header h1 {
            margin: 0;
            font-size: 2rem;
        }
        .game-name {
            font-size: 1.2rem;
            color: #009dc4;
            font-weight: bold;
            margin-left: 12px;
        }
        @media (max-width: 700px) {
            .leaderboard-table th, .leaderboard-table td {
                padding: 8px 4px;
                font-size: 0.95rem;
                min-width: 60px;
            }
            .leaderboard-header h1 {
                font-size: 1.2rem;
            }
            .game-name {
                font-size: 1rem;
            }
        }
        @media (max-width: 500px) {
            .leaderboard-table th, .leaderboard-table td {
                padding: 6px 2px;
                font-size: 0.85rem;
                min-width: 40px;
            }
            .leaderboard-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .game-name {
                margin-left: 0;
                margin-top: 6px;
            }
        }
            .footer-text {
                text-align: center;
                color: rgb(15, 15, 15);
                margin: 0;
                font-size: 1rem;
            }
    </style>
    <!-- ...existing code... -->
</head>
<body>
    <div class="main-content">
        <div class="leaderboard-header">
            <h1 class="leaderboards-title">Leaderboards</h1>
            <div class="game-name">Perlas Game</div>
        </div>
        <div class="table-responsive">
            <table class="leaderboard-table" id="leaderboardTable">
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Total Fish</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                </tbody>
            </table>
        </div>
    </div>
    <footer class="footer">
    <p class="footer-text">PERLAS 2024</p>
    </footer>
    <!-- Firebase leaderboard script -->
    <script defer src="Page/JS/firebase-init.js"></script>
    <script>
    // Use loadFirebase() to ensure Firebase is loaded before accessing database
    document.addEventListener('DOMContentLoaded', function() {
        loadFirebase().then(function(firebase) {
            const leaderboardBody = document.getElementById('leaderboardBody');
            leaderboardBody.innerHTML = '';
            firebase.database().ref('users').once('value').then(function(usersSnap) {
                const users = usersSnap.val() || {};
                const leaderboard = [];
                const userEntries = Object.entries(users);
                let userFetches = userEntries.map(([uid, user]) => {
                    return firebase.database().ref('users/' + uid + '/caughtFish').once('value').then(function(fishSnap) {
                        const caughtFish = fishSnap && fishSnap.val() ? Object.values(fishSnap.val()) : [];
                        let total = caughtFish.length;
                        leaderboard.push({
                            email: user.email ? user.email : 'Unknown',
                            total
                        });
                    });
                });
                Promise.all(userFetches).then(function() {
                    leaderboard.sort((a, b) => b.total - a.total);
                    leaderboardBody.innerHTML = '';
                    leaderboard.forEach(function(row, i) {
                        leaderboardBody.innerHTML += `<tr>
                            <td>${row.email}</td>
                            <td>${row.total}</td>
                        </tr>`;
                    });
                    if (leaderboard.length === 0) leaderboardBody.innerHTML = '<tr><td colspan="3">No data found.</td></tr>';
                });
            }).catch(function(err) {
                leaderboardBody.innerHTML = '<tr><td colspan="3">Failed to load leaderboard.</td></tr>';
            });
        });
    });
    </script>
