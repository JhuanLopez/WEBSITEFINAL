<!DOCTYPE html>
<html lang="en">
    <style>
        /* Add/override styles for leaderboard table */
        .main-content {
            margin-left: 260px;
            padding: 40px 20px 20px 20px;
            min-height: 100vh;
        }
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0,0,0,0.07);
        }
        .leaderboard-table th, .leaderboard-table td {
            padding: 16px 12px;
            text-align: center;
        }
        .leaderboard-table th {
            background: #e0f7fa;
            color: #006064;
            font-weight: 600;
        }
        .leaderboard-table tr:nth-child(even) {
            background: #f1f8fa;
        }
        .leaderboard-table tr:nth-child(odd) {
            background: #fff;
        }
        .leaderboards-title {
            font-size: 2rem;
        }
    </style>
    <!-- ...existing code... -->
</head>
<body>
    <div class="main-content">
        <h1 class="leaderboards-title">Leaderboards</h1>
        <table class="leaderboard-table" id="leaderboardTable">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Email</th>
                    <th>Total Fish</th>
                </tr>
            </thead>
            <tbody id="leaderboardBody">
            </tbody>
    </div>
    <footer class="footer">
        <p style="text-align: center; color: rgb(15, 15, 15);">PERLAS 2024</p>
    </footer>
    <!-- Firebase leaderboard script -->
    <script defer src="Page/JS/firebase-init.js"></script>
    <script>
    // Use loadFirebase() to ensure Firebase is loaded before accessing database
    document.addEventListener('DOMContentLoaded', function() {
        loadFirebase().then(function(firebase) {
            const leaderboardBody = document.getElementById('leaderboardBody');
            leaderboardBody.innerHTML = '';
            firebase.database().ref('users').once('value').then(function(usersSnap) {
                const users = usersSnap.val() || {};
                const leaderboard = [];
                const userEntries = Object.entries(users);
                let userFetches = userEntries.map(([uid, user]) => {
                    return firebase.database().ref('users/' + uid + '/caughtFish').once('value').then(function(fishSnap) {
                        const caughtFish = fishSnap && fishSnap.val() ? Object.values(fishSnap.val()) : [];
                        let total = 0;
                        for (const fish of caughtFish) {
                            total++;
                        }
                        leaderboard.push({
                            email: user.email || uid,
                            total
                        });
                    });
                });
                Promise.all(userFetches).then(function() {
                    leaderboard.sort((a, b) => b.total - a.total);
                    leaderboardBody.innerHTML = '';
                    leaderboard.forEach(function(row, i) {
                        leaderboardBody.innerHTML += `<tr>
                            <td>${i+1}</td>
                            <td>${row.email}</td>
                            <td>${row.total}</td>
                        </tr>`;
                    });
                    if (leaderboard.length === 0) leaderboardBody.innerHTML = '<tr><td colspan="3">No data found.</td></tr>';
                });
            }).catch(function(err) {
                leaderboardBody.innerHTML = '<tr><td colspan="3">Failed to load leaderboard.</td></tr>';
            });
        });
    });
    </script>
<!-- ...existing code ends after the script... -->